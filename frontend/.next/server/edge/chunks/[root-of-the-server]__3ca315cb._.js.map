{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 23, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/frontend/src/constants/roles.ts"],"sourcesContent":["export type Role = 'admin' | 'employee' | 'client';\r\n\r\nexport const rolePaths: Record<Role, string> = {\r\n  admin: '/admin/projects',\r\n  employee: '/employee/projects',\r\n  client: '/client',\r\n};\r\n\r\n"],"names":[],"mappings":";;;AAEO,MAAM,YAAkC;IAC7C,OAAO;IACP,UAAU;IACV,QAAQ;AACV"}},
    {"offset": {"line": 37, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/frontend/middleware.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport type { NextRequest } from 'next/server';\r\nimport { rolePaths, type Role } from './src/constants/roles';\r\n\r\nconst API_BASE_URL = process.env.NEXT_PUBLIC_API_BASE_URL ?? 'http://localhost:4000/api';\r\n\r\nconst protectedRoutes: { pattern: RegExp; roles: Role[] }[] = [\r\n  { pattern: /^\\/admin(\\/|$)/, roles: ['admin'] },\r\n  { pattern: /^\\/employee(\\/|$)/, roles: ['employee'] },\r\n  { pattern: /^\\/client(\\/|$)/, roles: ['client'] },\r\n];\r\n\r\nconst loginPath = '/login';\r\n\r\nasync function verifyToken(token: string) {\r\n  try {\r\n    const res = await fetch(`${API_BASE_URL}/auth/verify`, {\r\n      headers: {\r\n        Authorization: `Bearer ${token}`,\r\n      },\r\n      cache: 'no-store',\r\n    });\r\n\r\n    if (!res.ok) {\r\n      return null;\r\n    }\r\n\r\n    return (await res.json()) as { user: { role: Role } };\r\n  } catch (error) {\r\n    console.error('Token verification failed', error);\r\n    return null;\r\n  }\r\n}\r\n\r\nfunction redirectToLogin(request: NextRequest) {\r\n  const loginUrl = new URL(loginPath, request.url);\r\n  loginUrl.searchParams.set('redirectTo', request.nextUrl.pathname);\r\n  const response = NextResponse.redirect(loginUrl);\r\n  response.cookies.delete('auth_token');\r\n  return response;\r\n}\r\n\r\nexport async function middleware(request: NextRequest) {\r\n  const { pathname } = request.nextUrl;\r\n  const token = request.cookies.get('auth_token')?.value;\r\n\r\n  const matchedRoute = protectedRoutes.find(({ pattern }) => pattern.test(pathname));\r\n\r\n  // Handle login redirection when already authenticated\r\n  if (!matchedRoute) {\r\n    if (pathname === loginPath && token) {\r\n      const verified = await verifyToken(token);\r\n      if (verified?.user.role) {\r\n        return NextResponse.redirect(new URL(rolePaths[verified.user.role], request.url));\r\n      }\r\n    }\r\n    return NextResponse.next();\r\n  }\r\n\r\n  if (!token) {\r\n    return redirectToLogin(request);\r\n  }\r\n\r\n  const verified = await verifyToken(token);\r\n\r\n  if (!verified?.user) {\r\n    return redirectToLogin(request);\r\n  }\r\n\r\n  if (!matchedRoute.roles.includes(verified.user.role)) {\r\n    const destination = rolePaths[verified.user.role];\r\n    return NextResponse.redirect(new URL(destination, request.url));\r\n  }\r\n\r\n  return NextResponse.next();\r\n}\r\n\r\nexport const config = {\r\n  matcher: ['/admin/:path*', '/employee/:path*', '/client/:path*', '/login'],\r\n};\r\n\r\n"],"names":[],"mappings":";;;;AAAA;AAAA;AAEA;;;AAEA,MAAM,eAAe,QAAQ,GAAG,CAAC,wBAAwB,IAAI;AAE7D,MAAM,kBAAwD;IAC5D;QAAE,SAAS;QAAkB,OAAO;YAAC;SAAQ;IAAC;IAC9C;QAAE,SAAS;QAAqB,OAAO;YAAC;SAAW;IAAC;IACpD;QAAE,SAAS;QAAmB,OAAO;YAAC;SAAS;IAAC;CACjD;AAED,MAAM,YAAY;AAElB,eAAe,YAAY,KAAa;IACtC,IAAI;QACF,MAAM,MAAM,MAAM,MAAM,GAAG,aAAa,YAAY,CAAC,EAAE;YACrD,SAAS;gBACP,eAAe,CAAC,OAAO,EAAE,OAAO;YAClC;YACA,OAAO;QACT;QAEA,IAAI,CAAC,IAAI,EAAE,EAAE;YACX,OAAO;QACT;QAEA,OAAQ,MAAM,IAAI,IAAI;IACxB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,OAAO;IACT;AACF;AAEA,SAAS,gBAAgB,OAAoB;IAC3C,MAAM,WAAW,IAAI,IAAI,WAAW,QAAQ,GAAG;IAC/C,SAAS,YAAY,CAAC,GAAG,CAAC,cAAc,QAAQ,OAAO,CAAC,QAAQ;IAChE,MAAM,WAAW,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC;IACvC,SAAS,OAAO,CAAC,MAAM,CAAC;IACxB,OAAO;AACT;AAEO,eAAe,WAAW,OAAoB;IACnD,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;IACpC,MAAM,QAAQ,QAAQ,OAAO,CAAC,GAAG,CAAC,eAAe;IAEjD,MAAM,eAAe,gBAAgB,IAAI,CAAC,CAAC,EAAE,OAAO,EAAE,GAAK,QAAQ,IAAI,CAAC;IAExE,sDAAsD;IACtD,IAAI,CAAC,cAAc;QACjB,IAAI,aAAa,aAAa,OAAO;YACnC,MAAM,WAAW,MAAM,YAAY;YACnC,IAAI,UAAU,KAAK,MAAM;gBACvB,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,6IAAA,CAAA,YAAS,CAAC,SAAS,IAAI,CAAC,IAAI,CAAC,EAAE,QAAQ,GAAG;YACjF;QACF;QACA,OAAO,6LAAA,CAAA,eAAY,CAAC,IAAI;IAC1B;IAEA,IAAI,CAAC,OAAO;QACV,OAAO,gBAAgB;IACzB;IAEA,MAAM,WAAW,MAAM,YAAY;IAEnC,IAAI,CAAC,UAAU,MAAM;QACnB,OAAO,gBAAgB;IACzB;IAEA,IAAI,CAAC,aAAa,KAAK,CAAC,QAAQ,CAAC,SAAS,IAAI,CAAC,IAAI,GAAG;QACpD,MAAM,cAAc,6IAAA,CAAA,YAAS,CAAC,SAAS,IAAI,CAAC,IAAI,CAAC;QACjD,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,aAAa,QAAQ,GAAG;IAC/D;IAEA,OAAO,6LAAA,CAAA,eAAY,CAAC,IAAI;AAC1B;AAEO,MAAM,SAAS;IACpB,SAAS;QAAC;QAAiB;QAAoB;QAAkB;KAAS;AAC5E"}}]
}